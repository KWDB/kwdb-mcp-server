# KWDB Read Query Examples

## Basic Read Operations

```sql
-- List databases and show current
SHOW DATABASES;
SELECT current_database();

-- List tables
SHOW TABLES;
SHOW TABLES FROM database_name;

-- Show table structure
SHOW COLUMNS FROM table_name;
SHOW COLUMNS FROM database_name.table_name;
SHOW CREATE TABLE database_name.table_name;

-- Get column information
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'table_name';
```

## Relational Database Queries

```sql
-- Basic read with filtering and sorting
SELECT column1, column2 
FROM database_name.table_name 
WHERE condition 
ORDER BY column1 DESC 
LIMIT 100;

-- Count and aggregation functions
SELECT COUNT(*), AVG(amount), MAX(amount), MIN(amount)
FROM database_name.table_name;

-- Join operations
SELECT a.column1, b.column2 
FROM database_name.table_a a 
JOIN database_name.table_b b ON a.id = b.a_id
WHERE a.column1 > 100;

-- Aggregation with grouping
SELECT category, COUNT(*), SUM(amount)
FROM database_name.orders
GROUP BY category
HAVING COUNT(*) > 10
ORDER BY COUNT(*) DESC;

-- Subqueries and CTEs (Common Table Expressions)
SELECT * FROM database_name.customers
WHERE id IN (SELECT customer_id FROM database_name.orders WHERE amount > 1000);

WITH high_value_orders AS (
    SELECT customer_id, SUM(amount) as total
    FROM database_name.orders
    GROUP BY customer_id
    HAVING SUM(amount) > 10000
)
SELECT c.name, hvo.total
FROM database_name.customers c
JOIN high_value_orders hvo ON c.id = hvo.customer_id
ORDER BY hvo.total DESC;

-- Query execution plan analysis
EXPLAIN ANALYZE SELECT * FROM database_name.table_name WHERE condition;
```

## Time-Series Database Queries

```sql
-- Query time-series data with time range and tag filtering
SELECT ts, temperature, humidity 
FROM database_name.sensor_data 
WHERE ts BETWEEN '2023-01-01' AND '2023-01-31'
AND location = 'Shanghai'
ORDER BY ts;

-- Time interval aggregation
SELECT 
    date_trunc('hour', ts) AS hour,
    AVG(temperature) AS avg_temp,
    MAX(temperature) AS max_temp
FROM database_name.sensor_data
WHERE ts >= NOW() - INTERVAL '24 hours'
AND device_id = 123
GROUP BY hour
ORDER BY hour;

-- Latest values per entity (DISTINCT ON syntax)
SELECT DISTINCT ON (device_id) 
    ts, device_id, temperature, humidity
FROM database_name.sensor_data
ORDER BY device_id, ts DESC;
```

## System Information Queries

```sql
-- Check database version and connections
SELECT version();
SELECT * FROM pg_stat_activity;

-- Database and table metadata
SELECT * FROM information_schema.tables WHERE table_schema = 'public';

-- Database and table sizes
SELECT database_name, SUM(range_size) as total_bytes 
FROM kwdb_internal.ranges 
GROUP BY database_name;

SELECT database_name, table_name, SUM(range_size) as table_size_bytes
FROM kwdb_internal.ranges 
WHERE table_name IS NOT NULL
GROUP BY database_name, table_name;

-- Database and table creation times
SELECT database_name, MIN(mod_time) as creation_time 
FROM kwdb_internal.tables 
GROUP BY database_name;

-- System resource metrics
SELECT name, value FROM kwdb_internal.node_metrics 
WHERE name IN (
  -- CPU metrics
  'sys.cpu.sys.percent', 'sys.cpu.user.percent', 
  'sys.cpu.combined.percent-normalized',
  
  -- Memory metrics
  'sys.rss', 'sys.go.allocbytes',
  
  -- Disk I/O metrics
  'sys.host.disk.read.count', 'sys.host.disk.write.count',
  
  -- Other system metrics
  'sys.uptime', 'sys.fd.open', 'sys.goroutines'
);

-- List all system metrics (for exploration)
SELECT name FROM kwdb_internal.node_metrics WHERE name LIKE 'sys.%' ORDER BY name;
```

## Important Notes

- Always specify full table names with database_name prefix (e.g., db_relation.customers)
- Use BIGINT for foreign keys referencing IDs generated by SERIAL
- System metrics are available in kwdb_internal.node_metrics
- For table size and creation time, use kwdb_internal.ranges and kwdb_internal.tables